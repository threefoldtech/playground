import{d as R,u as U,r as c,a as W,b as r,o as D,c as B,w as o,g as C,e as y,f as l,m as P,j as v,k as x,n as z,_ as $,l as F,F as j}from"./index-df6f743d.js";import{g as h,h as w,P as k,d as G,r as q,a as K}from"./tf_deployment_list.vue_vue_type_script_setup_true_lang-1803a4f6.js";import{_ as V}from"./expandable_layout.vue_vue_type_script_setup_true_lang-235dc857.js";import"./list_table.vue_vue_type_script_setup_true_lang-046c7938.js";const Y=v("a",{href:"https://manual.grid.tf/weblets/weblets_caprover.html?highlight=caprover#caprover",target:"_blank",class:"app-link"}," Quick start documentation ",-1),Q=v("p",{style:{maxWidth:"880px"}}," You will need to point a wildcard DNS entry for the domain you entered above to this CapRover instance IP Address after deployment, otherwise, you won't be able to access the CapRover dashboard using this domain. ",-1),H=v("p",{class:"font-weight-bold mt-4"},[y(" If you don't know what Captain root domain is, make sure to visit the "),v("a",{target:"_blank",href:"https://manual.grid.tf/weblets/weblets_caprover.html?highlight=caprover#caprover",style:{color:"inherit"}}," Quick start documentation. ")],-1),J={name:"TfCaprover",components:{CaproverWorker:h,ExpandableLayout:V}},X=R({...J,setup(S){const s=U(),b=c(),u=W(),d=c(""),p=c(C(10)),i=c(w("CR"+C(9))),n=c([]);async function E(){s.value.setStatus("deploy");const e=k.Caprover.toLowerCase();try{const a=await x(u.profile,e);await s.value.validateBalance(a);const _=await G(a,{name:i.value.name,machines:[g(i.value,[{key:"SWM_NODE_MODE",value:"leader"},{key:"CAPROVER_ROOT_DOMAIN",value:d.value},{key:"CAPTAIN_IMAGE_VERSION",value:"latest"},{key:"PUBLIC_KEY",value:u.profile.ssh},{key:"DEFAULT_PASSWORD",value:p.value},{key:"CAPTAIN_IS_DEBUG",value:"true"}]),...n.value.map(f=>g(f,[{key:"SWM_NODE_MODE",value:"worker"},{key:"PUBLIC_KEY",value:u.profile.ssh}]))]});s.value.reloadDeploymentsList(),s.value.setStatus("success","Successfully deployed a caprover instance."),s.value.openDialog(_,{SWM_NODE_MODE:"Swarm Node Mode",PUBLIC_KEY:"Public SSH Key",CAPROVER_ROOT_DOMAIN:!1,CAPTAIN_IMAGE_VERSION:"Captain Image Version",DEFAULT_PASSWORD:"Default Password",CAPTAIN_IS_DEBUG:"Debug Mode"})}catch(a){s.value.setStatus("failed",z(a,"Failed to deploy a caprover instance."))}}function A(){n.value.push(w())}function g(e,a){return{name:e.name,cpu:e.solution.cpu,memory:e.solution.memory,flist:"https://hub.grid.tf/tf-official-apps/tf-caprover-latest.flist",entryPoint:"/sbin/zinit init",farmId:e.farm.farmID,farmName:e.farm.name,country:e.farm.country,publicIpv4:!0,planetary:!0,rootFilesystemSize:q(e.solution.cpu,e.solution.memory),disks:[{name:"data0",size:e.solution.disk,mountPoint:"/var/lib/docker"}],envs:a}}return(e,a)=>{const _=r("v-text-field"),f=r("input-validator"),I=r("v-alert"),N=r("password-input-wrapper"),L=r("d-tabs"),O=r("v-btn"),M=r("weblet-layout");return D(),B(M,{ref_key:"layout",ref:s},{title:o(()=>[y("Deploy Caprover")]),subtitle:o(()=>[y(" CapRover is an extremely easy to use app/database deployment & web server manager for your NodeJS, Python, PHP, ASP.NET, Ruby, MySQL, MongoDB, Postgres, WordPress (and etcâ€¦) applications! "),Y]),"footer-actions":o(()=>{var t;return[l(O,{color:"primary",variant:"tonal",onClick:E,disabled:(t=b.value)==null?void 0:t.invalid},{default:o(()=>[y(" Deploy ")]),_:1},8,["disabled"])]}),default:o(()=>[l(L,{tabs:[{title:"Config",value:"config"},{title:"Leader",value:"leader"},{title:"Workers",value:"workers"}],ref_key:"tabs",ref:b},{config:o(()=>[l(f,{value:d.value,rules:[e.validators.required("Domain is required."),e.validators.pattern("Please provide a valid domain.",{pattern:/^\b((?=[a-z0-9-]{1,63}\.)(xn--)?[a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,63}\b$/})]},{default:o(({props:t})=>[l(_,P({label:"Domain",modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=m=>d.value=m)},t,{autofocus:""}),null,16,["modelValue"])]),_:1},8,["value","rules"]),l(I,{type:"warning",variant:"tonal",class:"mb-6"},{default:o(()=>[Q,H]),_:1}),l(N,null,{default:o(({props:t})=>[l(f,{value:p.value,rules:[e.validators.required("Password is required."),e.validators.minLength("Password minLength is 6 chars.",6),e.validators.maxLength("Password maxLength is 15 chars.",15)]},{default:o(({props:m})=>[l(_,P({label:"Password",modelValue:p.value,"onUpdate:modelValue":a[1]||(a[1]=T=>p.value=T)},{...t,...m}),null,16,["modelValue"])]),_:2},1032,["value","rules"])]),_:1})]),leader:o(()=>[l(h,{modelValue:i.value,"onUpdate:modelValue":a[2]||(a[2]=t=>i.value=t)},null,8,["modelValue"])]),workers:o(()=>[l(V,{modelValue:n.value,"onUpdate:modelValue":a[3]||(a[3]=t=>n.value=t),onAdd:A},{default:o(({index:t})=>[l(h,{modelValue:n.value[t],"onUpdate:modelValue":m=>n.value[t]=m},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["modelValue"])]),_:1},512)]),_:1},512)}}}),Z={name:"CaproverView",components:{TfCaprover:X,TfDeploymentList:K},setup(){return{name:k.Caprover}}},ee={class:"mt-4"};function ae(S,s,b,u,d,p){const i=r("TfCaprover"),n=r("TfDeploymentList");return D(),F(j,null,[l(i),v("div",ee,[l(n,{"project-name":u.name},null,8,["project-name"])])],64)}const se=$(Z,[["render",ae]]);export{se as default};
