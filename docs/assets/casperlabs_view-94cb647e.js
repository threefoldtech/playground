import{g as h,h as B,i as F,r as I,_ as H}from"./tf_deployment_list.vue_vue_type_script_setup_true_lang-457f78f2.js";import{_ as N,P as L,d as j}from"./root_fs-ad9e737f.js";import{d as M,u as U,r as f,a as R,b as m,o as x,c as q,w as i,g as z,e as S,f as l,h as G,m as K,i as O,j as Y,p as d,q as w,s as $,y as Q,z as C,_ as W,A as J,F as X}from"./index-b070312d.js";import{_ as D}from"./select_gateway_node.vue_vue_type_script_setup_true_lang-35400cc0.js";import"./list_table.vue_vue_type_script_setup_true_lang-7117335a.js";const Z=$("a",{target:"_blank",href:"https://manual.grid.tf/weblets/weblets_casper.html",class:"app-link"}," Quick start documentation ",-1),ee={name:"TFCasperlabs",components:{SelectSolutionFlavor:h,SelectGatewayNode:D,SelectFarm:N}},ae=M({...ee,setup(P){const a=U(),_=f(!1),v=R(),o=f("CL"+z(9)),t=f(),n=f(),s=f();async function E(){a.value.setStatus("deploy");const g=L.Caprover.toLowerCase(),e=B({deploymentName:o.value,projectName:g,twinId:v.profile.twinId}),y=e+"."+n.value.domain;let r,p;try{r=await Q(v.profile,g),await a.value.validateBalance(r),p=await j(r,{name:o.value,machines:[{name:o.value,cpu:t.value.cpu,memory:t.value.memory,disks:[{size:t.value.disk,mountPoint:"/data"}],flist:"https://hub.grid.tf/tf-official-apps/casperlabs-latest.flist",entryPoint:"/init.sh",farmId:s.value.farmID,farmName:s.value.name,country:s.value.country,envs:[{key:"SSH_KEY",value:y},{key:"CASPERLABS_HOSTNAME",value:y}]}]})}catch(c){return a.value.setStatus("failed",C(c,"Failed to deploy a Casperlabs instance."))}try{a.value.setStatus("deploy","Preparing to deploy gateway..."),await F(r,{name:e,nodeId:n.value.id,backends:[`http://[${p[0].planetary}]:80`]}),a.value.reloadDeploymentsList(),a.value.setStatus("success","Successfully deployed a Casperlabs instance."),a.value.openDialog(p,{SSH_KEY:"SSH Key",CASPERLABS_HOSTNAME:"Casperlabs Hostname"})}catch(c){a.value.setStatus("deploy","Rollbacking back due to fail to deploy gateway..."),await I(r,o.value),a.value.setStatus("failed",C(c,"Failed to deploy a Casperlabs instance."))}}return(g,e)=>{const y=m("v-text-field"),r=m("input-validator"),p=m("form-validator"),c=m("v-btn"),T=m("weblet-layout");return x(),q(T,{ref_key:"layout",ref:a},{title:i(()=>[S("Deploy a Casperlabs Instance ")]),subtitle:i(()=>[S(" Casper Network is a blockchain protocol built from the ground up to remain true to core Web3 principles and adapt to the needs of our evolving world. "),Z]),"footer-actions":i(()=>[l(c,{color:"primary",variant:"tonal",onClick:E,disabled:!_.value},{default:i(()=>[S(" Deploy ")]),_:1},8,["disabled"])]),default:i(()=>[l(p,{modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=b=>_.value=b)},{default:i(()=>{var b,V,k;return[l(r,{value:o.value,rules:[G("Name is required."),K("Name minLength is 2 chars.",2),O("Name maxLength is 15 chars.",15)]},{default:i(({props:u})=>[l(y,Y({label:"Name",modelValue:o.value,"onUpdate:modelValue":e[0]||(e[0]=A=>o.value=A)},u),null,16,["modelValue"])]),_:1},8,["value","rules"]),l(h,{modelValue:d(t),"onUpdate:modelValue":e[1]||(e[1]=u=>w(t)?t.value=u:null)},null,8,["modelValue"]),l(D,{modelValue:d(n),"onUpdate:modelValue":e[2]||(e[2]=u=>w(n)?n.value=u:null)},null,8,["modelValue"]),l(N,{filters:{cpu:(b=d(t))==null?void 0:b.cpu,memory:(V=d(t))==null?void 0:V.memory,ssd:(k=d(t))==null?void 0:k.disk,publicIp:!1},modelValue:d(s),"onUpdate:modelValue":e[3]||(e[3]=u=>w(s)?s.value=u:null)},null,8,["filters","modelValue"])]}),_:1},8,["modelValue"])]),_:1},512)}}}),te={name:"CasperlabsView",components:{TfDeploymentList:H,TfCasperlabs:ae},setup(){return{name:L.Casperlabs}}},le={class:"mt-4"};function oe(P,a,_,v,o,t){const n=m("tf-casperlabs"),s=m("TfDeploymentList");return x(),J(X,null,[l(n),$("div",le,[l(s,{"project-name":v.name},null,8,["project-name"])])],64)}const me=W(te,[["render",oe]]);export{me as default};
