import{d as z,u as G,r as i,a as K,b as d,o as V,c as Y,w as o,g as T,e as L,f as a,h as P,m as A,i as U,j as b,p,q as g,s as W,y as Q,z as C,_ as J,A as X,F as Z}from"./index-b7afd9dd.js";import{_ as h,P as E,d as ee,r as ae}from"./root_fs-caa8e3a5.js";import{g as R,h as le,i as oe,r as te,_ as se}from"./tf_deployment_list.vue_vue_type_script_setup_true_lang-1240b60d.js";import{_ as x}from"./select_gateway_node.vue_vue_type_script_setup_true_lang-102db2ef.js";import{c as ne,_ as F}from"./smtp_server.vue_vue_type_script_setup_true_lang-9ef0414e.js";import"./list_table.vue_vue_type_script_setup_true_lang-dd240133.js";const ue=W("a",{target:"_blank",class:"app-link",href:"https://library.threefold.me/info/manual/#/manual__weblets_owncloud"}," Quick start documentation ",-1),re={name:"TfOwncloud",components:{SmtpServer:F,SelectSolutionFlavor:R,SelectGatewayNode:x,SelectFarm:h}},ie=z({...re,setup($){const t=G(),D=i(),v=K(),r=i("MM"+T(9)),f=i("admin"),c=i(T(12)),l=i(),O=i(),_=i(),s=i(ne());async function B(){t.value.setStatus("deploy");const N=E.Owncloud.toLowerCase(),e=le({deploymentName:r.value,projectName:N,twinId:v.profile.twinId}),y=e+"."+O.value.domain;let u,w;try{u=await Q(v.profile,N),await t.value.validateBalance(u),w=await ee(u,{name:r.value,machines:[{name:r.value,cpu:l.value.cpu,memory:l.value.memory,disks:[{size:l.value.disk,mountPoint:"/var/lib/docker"}],flist:"https://hub.grid.tf/tf-official-apps/owncloud-10.9.1.flist",entryPoint:"/sbin/zinit init",rootFilesystemSize:ae(l.value.cpu,l.value.memory),farmId:_.value.farmID,farmName:_.value.name,country:_.value.country,planetary:!0,envs:[{key:"SSH_KEY",value:v.profile.ssh},{key:"OWNCLOUD_ADMIN_USERNAME",value:f.value},{key:"OWNCLOUD_ADMIN_PASSWORD",value:c.value},{key:"OWNCLOUD_DOMAIN",value:y},...s.value.enabled?[{key:"OWNCLOUD_MAIL_SMTP_SECURE",value:s.value.tls?"tls":s.value.ssl?"ssl":"none"},{key:"OWNCLOUD_MAIL_FROM_ADDRESS",value:s.value.email.split("@")[0]},{key:"OWNCLOUD_MAIL_DOMAIN",value:s.value.email.split("@")[1]},{key:"OWNCLOUD_MAIL_SMTP_HOST",value:s.value.hostname},{key:"OWNCLOUD_MAIL_SMTP_PORT",value:s.value.port.toString()},{key:"OWNCLOUD_MAIL_SMTP_NAME",value:s.value.username},{key:"OWNCLOUD_MAIL_SMTP_PASSWORD",value:s.value.password}]:[]]}]})}catch(S){return t.value.setStatus("failed",C(S,"Failed to deploy a owncloud instance."))}try{t.value.setStatus("deploy","Preparing to deploy gateway..."),await oe(u,{name:e,nodeId:O.value.id,backends:[`http://[${w[0].planetary}]:80`]}),t.value.reloadDeploymentsList(),t.value.setStatus("success","Successfully deployed a owncloud instance."),t.value.openDialog(w,{SSH_KEY:"Public SSH Key",OWNCLOUD_DOMAIN:"Owncloud Domain",OWNCLOUD_ADMIN_USERNAME:"Owncloud Admin Username",OWNCLOUD_ADMIN_PASSWORD:"Owncloud Admin Password",OWNCLOUD_MAIL_SMTP_SECURE:"Owncloud Mail SMTP Secure",OWNCLOUD_MAIL_DOMAIN:"Owncloud Mail Domain",OWNCLOUD_MAIL_FROM_ADDRESS:"Owncloud Mail From Address",OWNCLOUD_MAIL_SMTP_HOST:"Owncloud Mail SMTP Host",OWNCLOUD_MAIL_SMTP_PORT:"Owncloud Mail SMTP Port",OWNCLOUD_MAIL_SMTP_NAME:"Owncloud Mail SMTP Name",OWNCLOUD_MAIL_SMTP_PASSWORD:"Owncloud Mail SMTP Password"})}catch(S){t.value.setStatus("deploy","Rollbacking back due to fail to deploy gateway..."),await te(u,r.value),t.value.setStatus("failed",C(S,"Failed to deploy a owncloud instance."))}}return(N,e)=>{const y=d("v-text-field"),u=d("input-validator"),w=d("password-input-wrapper"),S=d("d-tabs"),H=d("v-btn"),j=d("weblet-layout");return V(),Y(j,{ref_key:"layout",ref:t},{title:o(()=>[L("Deploy an Owncloud Instance ")]),subtitle:o(()=>[L(" Owncloud develops and provides open-source software for content collaboration, allowing teams to easily share and work on files seamlessly regardless of device or location. "),ue]),"footer-actions":o(()=>{var m;return[a(H,{color:"primary",variant:"tonal",onClick:B,disabled:(m=D.value)==null?void 0:m.invalid},{default:o(()=>[L(" Deploy ")]),_:1},8,["disabled"])]}),default:o(()=>[a(S,{tabs:[{title:"Base",value:"base"},{title:"SMTP Server",value:"smtp"}],ref_key:"tabs",ref:D},{base:o(()=>{var m,k,I;return[a(u,{value:r.value,rules:[P("Name is required."),A("Name minLength is 2 chars.",2),U("Name maxLength is 15 chars.",15)]},{default:o(({props:n})=>[a(y,b({label:"Name",modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=M=>r.value=M)},n),null,16,["modelValue"])]),_:1},8,["value","rules"]),a(u,{value:f.value,rules:[P("Username is required."),A("Username minLength is 2 chars.",2),U("Username maxLength is 15 chars.",15)]},{default:o(({props:n})=>[a(y,b({label:"Username",modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=M=>f.value=M)},n),null,16,["modelValue"])]),_:1},8,["value","rules"]),a(w,null,{default:o(({props:n})=>[a(u,{value:c.value,rules:[P("Password is required."),A("Password minLength is 6 chars.",6),U("Password maxLength is 15 chars.",15)]},{default:o(({props:M})=>[a(y,b({label:"Password",modelValue:c.value,"onUpdate:modelValue":e[2]||(e[2]=q=>c.value=q)},{...n,...M}),null,16,["modelValue"])]),_:2},1032,["value","rules"])]),_:1}),a(R,{modelValue:p(l),"onUpdate:modelValue":e[3]||(e[3]=n=>g(l)?l.value=n:null)},null,8,["modelValue"]),a(x,{modelValue:p(O),"onUpdate:modelValue":e[4]||(e[4]=n=>g(O)?O.value=n:null)},null,8,["modelValue"]),a(h,{filters:{cpu:(m=p(l))==null?void 0:m.cpu,memory:(k=p(l))==null?void 0:k.memory,ssd:(I=p(l))==null?void 0:I.disk,publicIp:!1},modelValue:p(_),"onUpdate:modelValue":e[5]||(e[5]=n=>g(_)?_.value=n:null)},null,8,["filters","modelValue"])]}),smtp:o(()=>[a(F,{modelValue:s.value,"onUpdate:modelValue":e[6]||(e[6]=m=>s.value=m),tls:"",ssl:"",email:""},{default:o(()=>[L(" Configure these settings only If you have an smtp service and you know what youâ€™re doing. ")]),_:1},8,["modelValue"])]),_:1},512)]),_:1},512)}}}),de={name:"MattermostView",components:{TfOwncloud:ie,TfDeploymentList:se},setup(){return{name:E.Owncloud}}},me={class:"mt-4"};function ce($,t,D,v,r,f){const c=d("TfOwncloud"),l=d("TfDeploymentList");return V(),X(Z,null,[a(c),W("div",me,[a(l,{"project-name":v.name},null,8,["project-name"])])],64)}const we=J(de,[["render",ce]]);export{we as default};
