import{d as M,u as q,r,a as I,b as i,o as L,c as J,w as n,g as N,e as U,f as a,m as g,h as V,i as E,j as P,k as B,n as b,_ as C,l as H,F as W}from"./index-df6f743d.js";import{i as D,_ as F,P as R,j as x,d as z,k as K,l as Q,a as X}from"./tf_deployment_list.vue_vue_type_script_setup_true_lang-1803a4f6.js";import{_ as A}from"./select_gateway_node.vue_vue_type_script_setup_true_lang-ef88227d.js";import"./list_table.vue_vue_type_script_setup_true_lang-046c7938.js";const Y=P("a",{target:"_blank",href:"https://manual.grid.tf/weblets/weblets_funkwhale.html",class:"app-link"}," Quick start documentation ",-1),Z={name:"TfFunkwhale",components:{SelectSolutionFlavor:D,SelectGatewayNode:A,SelectFarm:F}},ee=M({...Z,setup(T){const o=q(),k=r(!1),S=I(),u=r("FW"+N(9)),_=r("admin"),m=r(""),p=r(N(12)),v=r(),w=r(),c=r();async function j(){o.value.setStatus("deploy");const t=R.Funkwhale.toLowerCase(),e=x({deploymentName:u.value,projectName:t,twinId:S.profile.twinId}),f=e+"."+w.value.domain;let s,y;try{s=await B(S.profile,t),await o.value.validateBalance(s),y=await z(s,{name:u.value,machines:[{name:u.value,cpu:v.value.cpu,memory:v.value.memory,disks:[{size:v.value.disk,mountPoint:"/data"}],flist:"https://hub.grid.tf/tf-official-apps/funkwhale-dec21.flist",entryPoint:"/init.sh",farmId:c.value.farmID,farmName:c.value.name,country:c.value.country,envs:[{key:"FUNKWHALE_HOSTNAME",value:f},{key:"DJANGO_SUPERUSER_EMAIL",value:m.value},{key:"DJANGO_SUPERUSER_USERNAME",value:_.value},{key:"DJANGO_SUPERUSER_PASSWORD",value:p.value}]}]})}catch(h){return o.value.setStatus("failed",b(h,"Failed to deploy a funkwhale instance."))}try{o.value.setStatus("deploy","Preparing to deploy gateway..."),await K(s,{name:e,nodeId:w.value.id,backends:[`http://[${y[0].planetary}]:80/`]}),o.value.reloadDeploymentsList(),o.value.setStatus("success","Successfully deployed a funkwhale instance."),o.value.openDialog(y,{FUNKWHALE_HOSTNAME:"Funkwhale Hostname",DJANGO_SUPERUSER_EMAIL:"Django Superuser Email",DJANGO_SUPERUSER_USERNAME:"Diango Superuser Username",DJANGO_SUPERUSER_PASSWORD:"Django Superuser Password"})}catch(h){o.value.setStatus("deploy","Rollbacking back due to fail to deploy gateway..."),await Q(s,u.value),o.value.setStatus("failed",b(h,"Failed to deploy a funkwhale instance."))}}return(t,e)=>{const f=i("v-text-field"),s=i("input-validator"),y=i("password-input-wrapper"),h=i("form-validator"),O=i("v-btn"),$=i("weblet-layout");return L(),J($,{ref_key:"layout",ref:o},{title:n(()=>[U("Deploy a Funkwhale Instance ")]),subtitle:n(()=>[U(" Funkwhale is social platform to enjoy and share music. Funkwhale is a community-driven project that lets you listen and share music and audio within a decentralized, open network. "),Y]),"footer-actions":n(()=>[a(O,{color:"primary",variant:"tonal",onClick:j,disabled:!k.value},{default:n(()=>[U(" Deploy ")]),_:1},8,["disabled"])]),default:n(()=>[a(h,{modelValue:k.value,"onUpdate:modelValue":e[7]||(e[7]=l=>k.value=l)},{default:n(()=>[a(s,{value:u.value,rules:[t.validators.required("Name is required."),t.validators.minLength("Name minLength is 2 chars.",2),t.validators.maxLength("Name maxLength is 15 chars.",15)]},{default:n(({props:l})=>[a(f,g({label:"Name",modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=d=>u.value=d)},l),null,16,["modelValue"])]),_:1},8,["value","rules"]),a(s,{value:_.value,rules:[t.validators.required("Username is required."),t.validators.minLength("Username minLength is 2 chars.",2),t.validators.maxLength("Username maxLength is 15 chars.",15)]},{default:n(({props:l})=>[a(f,g({label:"Username",modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=d=>_.value=d)},l),null,16,["modelValue"])]),_:1},8,["value","rules"]),a(s,{value:m.value,rules:[t.validators.required("Email is required."),t.validators.isEmail("Please provide a valid email address.")]},{default:n(({props:l})=>[a(f,g({label:"Email",placeholder:"This email will be used to login to your instance.",modelValue:m.value,"onUpdate:modelValue":e[2]||(e[2]=d=>m.value=d)},l),null,16,["modelValue"])]),_:1},8,["value","rules"]),a(y,null,{default:n(({props:l})=>[a(s,{value:p.value,rules:[t.validators.required("Password is required."),t.validators.minLength("Password minLength is 6 chars.",6),t.validators.maxLength("Password maxLength is 15 chars.",15)]},{default:n(({props:d})=>[a(f,g({label:"Password",modelValue:p.value,"onUpdate:modelValue":e[3]||(e[3]=G=>p.value=G)},{...l,...d}),null,16,["modelValue"])]),_:2},1032,["value","rules"])]),_:1}),a(D,{modelValue:V(v),"onUpdate:modelValue":e[4]||(e[4]=l=>E(v)?v.value=l:null)},null,8,["modelValue"]),a(A,{modelValue:V(w),"onUpdate:modelValue":e[5]||(e[5]=l=>E(w)?w.value=l:null)},null,8,["modelValue"]),a(F,{modelValue:V(c),"onUpdate:modelValue":e[6]||(e[6]=l=>E(c)?c.value=l:null)},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1},512)}}}),ae={name:"FunkwhaleView",components:{TfFunkwhale:ee,TfDeploymentList:X},setup(){return{name:R.Funkwhale}}},le={class:"mt-4"};function te(T,o,k,S,u,_){const m=i("TfFunkwhale"),p=i("TfDeploymentList");return L(),H(W,null,[a(m),P("div",le,[a(p,{"project-name":S.name},null,8,["project-name"])])],64)}const re=C(ae,[["render",te]]);export{re as default};
