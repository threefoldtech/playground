import{d as R,u as W,r as u,a as Z,b as m,o as G,c as J,w as t,g as N,e as w,f as a,h as f,m as C,i as I,j as b,k as D,l as P,n as U,p as O,q as X,s as B,t as ee,v as le,x as ae,y as te,z as se,_ as ue,A as oe,F as ne}from"./index-b070312d.js";import{_ as $,P as q,d as ie}from"./root_fs-ad9e737f.js";import{_ as A}from"./select_vm_image.vue_vue_type_script_setup_true_lang-95286e4c.js";import{_ as j}from"./expandable_layout.vue_vue_type_script_setup_true_lang-ee7a0f06.js";import{_ as me}from"./tf_deployment_list.vue_vue_type_script_setup_true_lang-457f78f2.js";import"./list_table.vue_vue_type_script_setup_true_lang-7117335a.js";const re=B("a",{class:"app-link",href:"https://manual.grid.tf/weblets/weblets_fullVm.html",target:"_blank"}," Quick start documentation ",-1),de={class:"text-h6 mb-4"},ve={name:"FullVm",components:{SelectVmImage:A,SelectFarm:$,ExpandableLayout:j}},pe=R({...ve,setup(E){const n=W(),F=u(),g=Z(),L=[{name:"Ubuntu-22.04",flist:"https://hub.grid.tf/tf-official-vms/ubuntu-22.04.flist",entryPoint:"/init.sh"},{name:"Ubuntu-20.04",flist:"https://hub.grid.tf/tf-official-vms/ubuntu-20.04-lts.flist",entryPoint:"/init.sh"},{name:"Ubuntu-18.04",flist:"https://hub.grid.tf/tf-official-vms/ubuntu-18.04-lts.flist",entryPoint:"/init.sh"},{name:"Nixos-22.11",flist:"https://hub.grid.tf/tf-official-vms/nixos-22.11.flist",entryPoint:"/init.sh"}],d=u("VM"+N(8)),v=u(),r=u(4),y=u(8192),_=u(50),k=u(!1),z=u(!1),M=u(!0),S=u(!1),p=u(),o=u([]);function T(){const V=N(7);o.value.push({name:"DISK"+V,size:50,mountPoint:"/mnt/"+V})}async function K(){n.value.setStatus("deploy");const V=q.Fullvm.toLowerCase();try{const l=await te(g.profile,V);await n.value.validateBalance(l);const i=await ie(l,{name:d.value,machines:[{name:d.value,cpu:r.value,memory:y.value,flist:v.value.value,entryPoint:v.value.entryPoint,farmId:p.value.farmID,farmName:p.value.name,country:p.value.country,disks:[{size:_.value,mountPoint:"/"},...o.value],publicIpv4:k.value,publicIpv6:z.value,planetary:M.value,envs:[{key:"SSH_KEY",value:g.profile.ssh}],rootFilesystemSize:2}],network:{addAccess:S.value}});n.value.reloadDeploymentsList(),n.value.setStatus("success","Successfully deployed a full virtual machine instance."),n.value.openDialog(i,{SSH_KEY:"Public SSH Key"})}catch(l){n.value.setStatus("failed",se(l,"Failed to deploy a full virtual machine instance."))}}return(V,l)=>{const i=m("v-text-field"),c=m("input-validator"),h=m("v-switch"),H=m("d-tabs"),Y=m("v-btn"),Q=m("weblet-layout");return G(),J(Q,{ref_key:"layout",ref:n},{title:t(()=>[w("Deploy a Full Virtual Machine")]),subtitle:t(()=>[w("Deploy a new full virtual machine on the Threefold Grid "),re,w(" . ")]),default:t(()=>[a(H,{tabs:[{title:"Config",value:"config"},{title:"Disks",value:"disks"}]},{config:t(()=>[a(c,{value:d.value,rules:[f("Name is required."),C("Name minLength is 2 chars.",2),I("Name maxLength is 15 chars.",15)]},{default:t(({props:e})=>[a(i,b({label:"Name",modelValue:d.value,"onUpdate:modelValue":l[0]||(l[0]=s=>d.value=s)},e),null,16,["modelValue"])]),_:1},8,["value","rules"]),a(A,{images:L,modelValue:v.value,"onUpdate:modelValue":l[1]||(l[1]=e=>v.value=e)},null,8,["modelValue"]),a(c,{value:r.value,rules:[f("CPU is required."),D("CPU must be a valid integer."),P("CPU min is 2 cores.",2),U("CPU max is 32 cores.",32)]},{default:t(({props:e})=>[a(i,b({label:"CPU (vCores)",type:"number",modelValue:r.value,"onUpdate:modelValue":l[2]||(l[2]=s=>r.value=s),modelModifiers:{number:!0}},e),null,16,["modelValue"])]),_:1},8,["value","rules"]),a(c,{value:y.value,rules:[f("Memory is required."),D("Memory must be a valid integer."),P("Minimum allowed memory is 256 MB.",256),U("Maximum allowed memory is 256 GB.",256*1024)]},{default:t(({props:e})=>[a(i,b({label:"Memory (MB)",type:"number",modelValue:y.value,"onUpdate:modelValue":l[3]||(l[3]=s=>y.value=s),modelModifiers:{number:!0}},e),null,16,["modelValue"])]),_:1},8,["value","rules"]),a(c,{value:_.value,rules:[f("Disk size is required."),D("Disk size must be a valid integer."),P("Minimum allowed disk size is 1 GB.",1),U("Maximum allowed disk size is 10000 GB.",1e4)]},{default:t(({props:e})=>[a(i,b({label:"Disk Size (GB)",type:"number",modelValue:_.value,"onUpdate:modelValue":l[4]||(l[4]=s=>_.value=s),modelModifiers:{number:!0}},e),null,16,["modelValue"])]),_:1},8,["value","rules"]),a(h,{color:"primary",inset:"",label:"Public IPv4",modelValue:k.value,"onUpdate:modelValue":l[5]||(l[5]=e=>k.value=e)},null,8,["modelValue"]),a(h,{color:"primary",inset:"",label:"Public IPv6",modelValue:z.value,"onUpdate:modelValue":l[6]||(l[6]=e=>z.value=e)},null,8,["modelValue"]),a(h,{color:"primary",inset:"",label:"Planetary Network",modelValue:M.value,"onUpdate:modelValue":l[7]||(l[7]=e=>M.value=e)},null,8,["modelValue"]),a(h,{color:"primary",inset:"",label:"Add Wireguard Access",modelValue:S.value,"onUpdate:modelValue":l[8]||(l[8]=e=>S.value=e)},null,8,["modelValue"]),a($,{filters:{cpu:r.value,memory:y.value,publicIp:k.value,ssd:o.value.reduce((e,s)=>e+s.size,_.value)},modelValue:O(p),"onUpdate:modelValue":l[9]||(l[9]=e=>X(p)?p.value=e:null)},null,8,["filters","modelValue"])]),disks:t(()=>[a(j,{modelValue:o.value,"onUpdate:modelValue":l[10]||(l[10]=e=>o.value=e),onAdd:T},{default:t(({index:e})=>[B("p",de,"Disk #"+ee(e+1),1),a(c,{value:o.value[e].name,rules:[f("Disk name is required."),le("Disk name can't start with a number, a non-alphanumeric character or a whitespace",{pattern:/^[A-Za-z]/}),C("Disk minLength is 2 chars.",2),ae("Disk name only accepts alphanumeric chars."),I("Disk maxLength is 15 chars.",15)]},{default:t(({props:s})=>[a(i,b({label:"Name",modelValue:o.value[e].name,"onUpdate:modelValue":x=>o.value[e].name=x},s),null,16,["modelValue","onUpdate:modelValue"])]),_:2},1032,["value","rules"]),a(c,{value:o.value[e].size,rules:[f("Disk size is required."),D("Disk size must be a valid integer."),P("Minimum allowed disk size is 1 GB.",1),U("Maximum allowed disk size is 10000 GB.",1e4)]},{default:t(({props:s})=>[a(i,b({label:"Size (GB)",type:"number",modelValue:o.value[e].size,"onUpdate:modelValue":x=>o.value[e].size=x,modelModifiers:{number:!0}},s),null,16,["modelValue","onUpdate:modelValue"])]),_:2},1032,["value","rules"])]),_:1},8,["modelValue"])]),_:1})]),"footer-actions":t(()=>{var e;return[a(Y,{color:"primary",variant:"tonal",onClick:K,disabled:(e=F.value)==null?void 0:e.invalid},{default:t(()=>[w(" Deploy ")]),_:1},8,["disabled"])]}),_:1},512)}}}),ce={name:"FullVirtualMachine",components:{FullVm:pe,TfDeploymentList:me},setup(){return{name:q.Fullvm}}},fe={class:"mt-4"};function be(E,n,F,g,L,d){const v=m("FullVm"),r=m("TfDeploymentList");return G(),oe(ne,null,[a(v),B("div",fe,[a(r,{"project-name":g.name},null,8,["project-name"])])],64)}const we=ue(ce,[["render",be]]);export{we as default};
