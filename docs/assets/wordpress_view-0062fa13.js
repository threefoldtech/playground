import{d as B,u as C,r as d,a as Q,b as i,o as I,c as x,w as o,g as N,e as k,f as a,m as h,h as y,i as P,j as M,k as G,n as D,_ as H,l as K,F as z}from"./index-df6f743d.js";import{i as E,_ as q,P as F,j as O,d as J,k as X,l as Z,a as ee}from"./tf_deployment_list.vue_vue_type_script_setup_true_lang-1803a4f6.js";import{_ as $}from"./select_gateway_node.vue_vue_type_script_setup_true_lang-ef88227d.js";import"./list_table.vue_vue_type_script_setup_true_lang-046c7938.js";const ae=M("a",{target:"_blank",href:"https://manual.grid.tf/weblets/weblets_wordpress.html",class:"app-link"}," Quick start documentation ",-1),le={name:"TFWordpress",components:{SelectSolutionFlavor:E,SelectGatewayNode:$,SelectFarm:q}},se=B({...le,setup(R){const t=C(),V=d(!1),b=Q(),u=d("WP"+N(9)),_=d("admin"),v=d(""),c=d(N(12)),n=d(),w=d(),f=d();async function T(){t.value.setStatus("deploy");const l=F.Wordpress.toLowerCase(),e=O({deploymentName:u.value,projectName:l,twinId:b.profile.twinId}),m=e+"."+w.value.domain;let r,g;try{r=await G(b.profile,l),await t.value.validateBalance(r),g=await J(r,{name:u.value,machines:[{name:u.value,cpu:n.value.cpu,memory:n.value.memory,disks:[{size:n.value.disk,mountPoint:"/var/www/html"}],flist:"https://hub.grid.tf/tf-official-apps/tf-wordpress-latest.flist",entryPoint:"/init.sh",farmId:f.value.farmID,farmName:f.value.name,country:f.value.country,envs:[{key:"SSH_KEY",value:m},{key:"MYSQL_USER",value:_.value},{key:"MYSQL_PASSWORD",value:c.value},{key:"ADMIN_EMAIL",value:v.value},{key:"WP_URL",value:m}]}]})}catch(S){return t.value.setStatus("failed",D(S,"Failed to deploy a Wordpress instance."))}try{t.value.setStatus("deploy","Preparing to deploy gateway..."),await X(r,{name:e,nodeId:w.value.id,backends:[`http://[${g[0].planetary}]:80`]}),t.value.reloadDeploymentsList(),t.value.setStatus("success","Successfully deployed a Wordpress instance."),t.value.openDialog(g,{SSH_KEY:"Public SSH Key",MYSQL_USER:"Mysql User",MYSQL_PASSWORD:"Mysql Password",ADMIN_EMAIL:"Admin Email",WP_URL:"WP URL"})}catch(S){t.value.setStatus("deploy","Rollbacking back due to fail to deploy gateway..."),await Z(r,u.value),t.value.setStatus("failed",D(S,"Failed to deploy a Wordpress instance."))}}return(l,e)=>{const m=i("v-text-field"),r=i("input-validator"),g=i("password-input-wrapper"),S=i("form-validator"),A=i("v-btn"),j=i("weblet-layout");return I(),x(j,{ref_key:"layout",ref:t},{title:o(()=>[k("Deploy a Wordpress Instance ")]),subtitle:o(()=>[k(" WordPress is the simplest, most popular way to create your own website or blog. In fact, WordPress powers over 43.3% of all the websites on the Internet. "),ae]),"footer-actions":o(()=>[a(A,{color:"primary",variant:"tonal",onClick:T,disabled:!V.value},{default:o(()=>[k(" Deploy ")]),_:1},8,["disabled"])]),default:o(()=>[a(S,{modelValue:V.value,"onUpdate:modelValue":e[7]||(e[7]=L=>V.value=L)},{default:o(()=>{var L,W,U;return[a(r,{value:u.value,rules:[l.validators.required("Name is required."),l.validators.minLength("Name minLength is 2 chars.",2),l.validators.maxLength("Name maxLength is 15 chars.",15)]},{default:o(({props:s})=>[a(m,h({label:"Name",modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=p=>u.value=p)},s),null,16,["modelValue"])]),_:1},8,["value","rules"]),a(r,{value:_.value,rules:[l.validators.required("Username is required."),l.validators.minLength("Username minLength is 2 chars.",2),l.validators.maxLength("Username maxLength is 15 chars.",15)]},{default:o(({props:s})=>[a(m,h({label:"Username",modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=p=>_.value=p)},s),null,16,["modelValue"])]),_:1},8,["value","rules"]),a(g,null,{default:o(({props:s})=>[a(r,{value:c.value,rules:[l.validators.required("Password is required."),l.validators.minLength("Password minLength is 6 chars.",6),l.validators.maxLength("Password maxLength is 15 chars.",15)]},{default:o(({props:p})=>[a(m,h({label:"Password",modelValue:c.value,"onUpdate:modelValue":e[2]||(e[2]=Y=>c.value=Y)},{...s,...p}),null,16,["modelValue"])]),_:2},1032,["value","rules"])]),_:1}),a(r,{value:v.value,rules:[l.validators.required("Email is required."),l.validators.isEmail("Please provide a valid email address.")]},{default:o(({props:s})=>[a(m,h({label:"Email",placeholder:"This email will be used to login to your instance.",modelValue:v.value,"onUpdate:modelValue":e[3]||(e[3]=p=>v.value=p)},s),null,16,["modelValue"])]),_:1},8,["value","rules"]),a(E,{modelValue:y(n),"onUpdate:modelValue":e[4]||(e[4]=s=>P(n)?n.value=s:null)},null,8,["modelValue"]),a($,{modelValue:y(w),"onUpdate:modelValue":e[5]||(e[5]=s=>P(w)?w.value=s:null)},null,8,["modelValue"]),a(q,{filters:{cpu:(L=y(n))==null?void 0:L.cpu,memory:(W=y(n))==null?void 0:W.memory,ssd:(U=y(n))==null?void 0:U.disk,publicIp:!1},modelValue:y(f),"onUpdate:modelValue":e[6]||(e[6]=s=>P(f)?f.value=s:null)},null,8,["filters","modelValue"])]}),_:1},8,["modelValue"])]),_:1},512)}}}),te={name:"WordpressView",components:{TFWordpress:se,TfDeploymentList:ee},setup(){return{name:F.Wordpress}}},oe={class:"mt-4"};function re(R,t,V,b,u,_){const v=i("TFWordpress"),c=i("TfDeploymentList");return I(),K(z,null,[a(v),M("div",oe,[a(c,{"project-name":b.name},null,8,["project-name"])])],64)}const me=H(te,[["render",re]]);export{me as default};
