import{d as Q,u as H,r as u,a as z,b as d,o as E,c as G,w as s,g as M,e as k,f as a,h as L,m as W,i as U,j as P,H as K,p as f,q as N,s as F,y as O,z as x,_ as J,A as X,F as Z}from"./index-db529f9f.js";import{_ as $,P as R,d as ee}from"./root_fs-a2832d70.js";import{g as T,h as ae,i as le,r as te,_ as se}from"./tf_deployment_list.vue_vue_type_script_setup_true_lang-584738f9.js";import{_ as q}from"./select_gateway_node.vue_vue_type_script_setup_true_lang-a273278c.js";import"./list_table.vue_vue_type_script_setup_true_lang-4e0f8b23.js";const oe=F("a",{target:"_blank",href:"https://manual.grid.tf/weblets/weblets_wordpress.html",class:"app-link"}," Quick start documentation ",-1),ne={name:"TFWordpress",components:{SelectSolutionFlavor:T,SelectGatewayNode:q,SelectFarm:$}},re=Q({...ne,setup(A){const t=H(),S=u(!1),V=z(),r=u("WP"+M(9)),_=u("admin"),p=u(""),c=u(M(12)),n=u(),y=u(),v=u();async function Y(){t.value.setStatus("deploy");const h=R.Wordpress.toLowerCase(),e=ae({deploymentName:r.value,projectName:h,twinId:V.profile.twinId}),i=e+"."+y.value.domain;let o,w;try{o=await O(V.profile,h),await t.value.validateBalance(o),w=await ee(o,{name:r.value,machines:[{name:r.value,cpu:n.value.cpu,memory:n.value.memory,disks:[{size:n.value.disk,mountPoint:"/var/www/html"}],flist:"https://hub.grid.tf/tf-official-apps/tf-wordpress-latest.flist",entryPoint:"/init.sh",farmId:v.value.farmID,farmName:v.value.name,country:v.value.country,envs:[{key:"SSH_KEY",value:i},{key:"MYSQL_USER",value:_.value},{key:"MYSQL_PASSWORD",value:c.value},{key:"ADMIN_EMAIL",value:p.value},{key:"WP_URL",value:i}]}]})}catch(g){return t.value.setStatus("failed",x(g,"Failed to deploy a Wordpress instance."))}try{t.value.setStatus("deploy","Preparing to deploy gateway..."),await le(o,{name:e,nodeId:y.value.id,backends:[`http://[${w[0].planetary}]:80`]}),t.value.reloadDeploymentsList(),t.value.setStatus("success","Successfully deployed a Wordpress instance."),t.value.openDialog(w,{SSH_KEY:"Public SSH Key",MYSQL_USER:"Mysql User",MYSQL_PASSWORD:"Mysql Password",ADMIN_EMAIL:"Admin Email",WP_URL:"WP URL"})}catch(g){t.value.setStatus("deploy","Rollbacking back due to fail to deploy gateway..."),await te(o,r.value),t.value.setStatus("failed",x(g,"Failed to deploy a Wordpress instance."))}}return(h,e)=>{const i=d("v-text-field"),o=d("input-validator"),w=d("password-input-wrapper"),g=d("form-validator"),j=d("v-btn"),B=d("weblet-layout");return E(),G(B,{ref_key:"layout",ref:t},{title:s(()=>[k("Deploy a Wordpress Instance ")]),subtitle:s(()=>[k(" WordPress is the simplest, most popular way to create your own website or blog. In fact, WordPress powers over 43.3% of all the websites on the Internet. "),oe]),"footer-actions":s(()=>[a(j,{color:"primary",variant:"tonal",onClick:Y,disabled:!S.value},{default:s(()=>[k(" Deploy ")]),_:1},8,["disabled"])]),default:s(()=>[a(g,{modelValue:S.value,"onUpdate:modelValue":e[7]||(e[7]=b=>S.value=b)},{default:s(()=>{var b,D,I;return[a(o,{value:r.value,rules:[L("Name is required."),W("Name minLength is 2 chars.",2),U("Name maxLength is 15 chars.",15)]},{default:s(({props:l})=>[a(i,P({label:"Name",modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=m=>r.value=m)},l),null,16,["modelValue"])]),_:1},8,["value","rules"]),a(o,{value:_.value,rules:[L("Username is required."),W("Username minLength is 2 chars.",2),U("Username maxLength is 15 chars.",15)]},{default:s(({props:l})=>[a(i,P({label:"Username",modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=m=>_.value=m)},l),null,16,["modelValue"])]),_:1},8,["value","rules"]),a(w,null,{default:s(({props:l})=>[a(o,{value:c.value,rules:[L("Password is required."),W("Password minLength is 6 chars.",6),U("Password maxLength is 15 chars.",15)]},{default:s(({props:m})=>[a(i,P({label:"Password",modelValue:c.value,"onUpdate:modelValue":e[2]||(e[2]=C=>c.value=C)},{...l,...m}),null,16,["modelValue"])]),_:2},1032,["value","rules"])]),_:1}),a(o,{value:p.value,rules:[L("Email is required."),K("Please provide a valid email address.")]},{default:s(({props:l})=>[a(i,P({label:"Email",placeholder:"This email will be used to login to your instance.",modelValue:p.value,"onUpdate:modelValue":e[3]||(e[3]=m=>p.value=m)},l),null,16,["modelValue"])]),_:1},8,["value","rules"]),a(T,{modelValue:f(n),"onUpdate:modelValue":e[4]||(e[4]=l=>N(n)?n.value=l:null)},null,8,["modelValue"]),a(q,{modelValue:f(y),"onUpdate:modelValue":e[5]||(e[5]=l=>N(y)?y.value=l:null)},null,8,["modelValue"]),a($,{filters:{cpu:(b=f(n))==null?void 0:b.cpu,memory:(D=f(n))==null?void 0:D.memory,ssd:(I=f(n))==null?void 0:I.disk,publicIp:!1},modelValue:f(v),"onUpdate:modelValue":e[6]||(e[6]=l=>N(v)?v.value=l:null)},null,8,["filters","modelValue"])]}),_:1},8,["modelValue"])]),_:1},512)}}}),ue={name:"WordpressView",components:{TFWordpress:re,TfDeploymentList:se},setup(){return{name:R.Wordpress}}},de={class:"mt-4"};function ie(A,t,S,V,r,_){const p=d("TFWordpress"),c=d("TfDeploymentList");return E(),X(Z,null,[a(p),F("div",de,[a(c,{"project-name":V.name},null,8,["project-name"])])],64)}const _e=J(ue,[["render",ie]]);export{_e as default};
