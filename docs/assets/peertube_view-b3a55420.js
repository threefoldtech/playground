import{d as z,u as C,r as i,a as W,b as r,o as D,c as G,w as s,g as L,e as S,f as a,h as g,m as R,i as h,j as T,H as K,p,q as k,s as x,y as Y,z as A,_ as Q,A as J,F as X}from"./index-b7afd9dd.js";import{_ as B,P as U,d as Z}from"./root_fs-caa8e3a5.js";import{g as $,h as ee,i as ae,r as te,_ as le}from"./tf_deployment_list.vue_vue_type_script_setup_true_lang-1240b60d.js";import{_ as M}from"./select_gateway_node.vue_vue_type_script_setup_true_lang-102db2ef.js";import"./list_table.vue_vue_type_script_setup_true_lang-dd240133.js";const oe=x("a",{target:"_blank",href:"https://library.threefold.me/info/manual/#/manual__weblets_peertube",class:"app-link"}," Quick start documentation ",-1),se={name:"TfPeertube",components:{SelectSolutionFlavor:$,SelectGatewayNode:M,SelectFarm:B}},ne=z({...se,setup(O){const t=C(),w=i(!1),c=W(),u=i("PT"+L(9)),_=i(""),d=i(L(12)),l=i(),v=i(),m=i();async function H(){t.value.setStatus("deploy");const V=U.Peertube.toLowerCase(),e=ee({deploymentName:u.value,projectName:V,twinId:c.profile.twinId}),f=e+"."+v.value.domain;let n,y;try{n=await Y(c.profile,V),await t.value.validateBalance(n),y=await Z(n,{name:u.value,machines:[{name:u.value,cpu:l.value.cpu,memory:l.value.memory,disks:[{size:l.value.disk,mountPoint:"/data"}],flist:"https://hub.grid.tf/tf-official-apps/peertube-v3.1.1.flist",entryPoint:"/sbin/zinit init",farmId:m.value.farmID,farmName:m.value.name,country:m.value.country,planetary:!0,envs:[{key:"SSH_KEY",value:c.profile.ssh},{key:"PEERTUBE_ADMIN_EMAIL",value:_.value},{key:"PT_INITIAL_ROOT_PASSWORD",value:d.value},{key:"PEERTUBE_WEBSERVER_HOSTNAME",value:f}]}]})}catch(b){return t.value.setStatus("failed",A(b,"Failed to deploy a peertube instance."))}try{t.value.setStatus("deploy","Preparing to deploy gateway..."),await ae(n,{name:e,nodeId:v.value.id,backends:[`http://[${y[0].planetary}]:9000`]}),t.value.reloadDeploymentsList(),t.value.setStatus("success","Successfully deployed a peertube instance."),t.value.openDialog(y,{SSH_KEY:"Public SSH Key",PEERTUBE_ADMIN_EMAIL:"Peertube Admin Email",PT_INITIAL_ROOT_PASSWORD:"Peertube Initial Root Password",PEERTUBE_WEBSERVER_HOSTNAME:"Peertube Webserver Hostname"})}catch(b){t.value.setStatus("deploy","Rollbacking back due to fail to deploy gateway..."),await te(n,u.value),t.value.setStatus("failed",A(b,"Failed to deploy a peertube instance."))}}return(V,e)=>{const f=r("v-text-field"),n=r("input-validator"),y=r("password-input-wrapper"),b=r("form-validator"),F=r("v-btn"),j=r("weblet-layout");return D(),G(j,{ref_key:"layout",ref:t},{title:s(()=>[S("Deploy a Peertube Instance")]),subtitle:s(()=>[S(" Peertube aspires to be a decentralized and free/libre alternative to video broadcasting services. "),oe]),"footer-actions":s(()=>[a(F,{color:"primary",variant:"tonal",onClick:H,disabled:!w.value},{default:s(()=>[S(" Deploy ")]),_:1},8,["disabled"])]),default:s(()=>[a(b,{modelValue:w.value,"onUpdate:modelValue":e[6]||(e[6]=E=>w.value=E)},{default:s(()=>{var E,N,I;return[a(n,{value:u.value,rules:[g("Name is required."),R("Name minLength is 2 chars.",2),h("Name maxLength is 15 chars.",15)]},{default:s(({props:o})=>[a(f,T({label:"Name",modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=P=>u.value=P)},o),null,16,["modelValue"])]),_:1},8,["value","rules"]),a(n,{value:_.value,rules:[g("Email is required."),K("Please provide a valid email address.")]},{default:s(({props:o})=>[a(f,T({label:"Admin Email",modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=P=>_.value=P)},o),null,16,["modelValue"])]),_:1},8,["value","rules"]),a(y,null,{default:s(({props:o})=>[a(n,{value:d.value,rules:[g("Password is required."),R("Password minLength is 6 chars.",6),h("Password maxLength is 15 chars.",15)]},{default:s(({props:P})=>[a(f,T({label:"Password",modelValue:d.value,"onUpdate:modelValue":e[2]||(e[2]=q=>d.value=q)},{...o,...P}),null,16,["modelValue"])]),_:2},1032,["value","rules"])]),_:1}),a($,{modelValue:p(l),"onUpdate:modelValue":e[3]||(e[3]=o=>k(l)?l.value=o:null)},null,8,["modelValue"]),a(M,{modelValue:p(v),"onUpdate:modelValue":e[4]||(e[4]=o=>k(v)?v.value=o:null)},null,8,["modelValue"]),a(B,{filters:{cpu:(E=p(l))==null?void 0:E.cpu,memory:(N=p(l))==null?void 0:N.memory,ssd:(I=p(l))==null?void 0:I.disk,publicIp:!1},modelValue:p(m),"onUpdate:modelValue":e[5]||(e[5]=o=>k(m)?m.value=o:null)},null,8,["filters","modelValue"])]}),_:1},8,["modelValue"])]),_:1},512)}}}),ue={name:"PeertubeView",components:{TfPeertube:ne,TfDeploymentList:le},setup(){return{name:U.Peertube}}},re={class:"mt-4"};function ie(O,t,w,c,u,_){const d=r("TfPeertube"),l=r("TfDeploymentList");return D(),J(X,null,[a(d),x("div",re,[a(l,{"project-name":c.name},null,8,["project-name"])])],64)}const ve=Q(ue,[["render",ie]]);export{ve as default};
