import{d as K,u as A,r as i,a as H,b as n,o as E,c as O,w as s,g as P,e as V,f as a,m as S,h as u,i as D,j as B,k as W,n as Y,_ as G,l as Q,F as J}from"./index-df6f743d.js";import{i as I,_ as M,P as T,d as X,r as N,a as Z}from"./tf_deployment_list.vue_vue_type_script_setup_true_lang-1803a4f6.js";import"./list_table.vue_vue_type_script_setup_true_lang-046c7938.js";const ee=B("a",{target:"_blank",href:"https://manual.grid.tf/weblets/weblets_umbrel.html",class:"app-link"}," Quick start documentation ",-1),ae={name:"TfUmbrel",components:{SelectSolutionFlavor:I,SelectFarm:M}},le=K({...ae,setup($){const r=A(),b=i(!1),y=H(),m=i("UM"+P(9)),c=i("admin"),d=i(P(12)),p=i(!1),l=i(),v=i();async function F(){r.value.setStatus("deploy");const t=T.Umbrel.toLowerCase();try{const e=await W(y.profile,t);await r.value.validateBalance(e);const f=await X(e,{name:m.value,machines:[{name:m.value,cpu:l.value.cpu,memory:l.value.memory,disks:[{size:10,mountPoint:"/var/lib/docker"},{size:l.value.disk,mountPoint:"/umbrelDisk"}],flist:"https://hub.grid.tf/tf-official-apps/umbrel-latest.flist",entryPoint:"/sbin/zinit init",farmId:v.value.farmID,farmName:v.value.name,country:v.value.country,planetary:!0,publicIpv4:p.value,envs:[{key:"SSH_KEY",value:y.profile.ssh},{key:"USERNAME",value:c.value},{key:"PASSWORD",value:d.value},{key:"UMBREL_DISK",value:"/umbrelDisk"}],rootFilesystemSize:N(l.value.cpu,l.value.memory)}]});r.value.reloadDeploymentsList(),r.value.setStatus("success","Successfully deployed an Umbrel instance."),r.value.openDialog(f,{SSH_KEY:"Public SSH Key",USERNAME:"Username",PASSWORD:"Password",UMBREL_DISK:"Umbrel Disk"})}catch(e){r.value.setStatus("failed",Y(e,"Failed to deploy an Umbrel instance."))}}return(t,e)=>{const f=n("v-text-field"),g=n("input-validator"),R=n("password-input-wrapper"),q=n("v-switch"),x=n("form-validator"),j=n("v-btn"),z=n("weblet-layout");return E(),O(z,{ref_key:"layout",ref:r},{title:s(()=>[V("Deploy an Umbrel Instance ")]),subtitle:s(()=>[V(" Umbrel is an OS for running a personal server in your home. Self-host open source apps like Nextcloud, Bitcoin node, and more. "),ee]),"footer-actions":s(()=>[a(j,{color:"primary",variant:"tonal",onClick:F,disabled:!b.value},{default:s(()=>[V(" Deploy ")]),_:1},8,["disabled"])]),default:s(()=>[a(x,{modelValue:b.value,"onUpdate:modelValue":e[6]||(e[6]=U=>b.value=U)},{default:s(()=>{var U,w,h,k,L;return[a(g,{value:m.value,rules:[t.validators.required("Name is required."),t.validators.minLength("Name minLength is 2 chars.",2),t.validators.maxLength("Name maxLength is 15 chars.",15)]},{default:s(({props:o})=>[a(f,S({label:"Name",modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=_=>m.value=_)},o),null,16,["modelValue"])]),_:1},8,["value","rules"]),a(g,{value:c.value,rules:[t.validators.required("Username is required."),t.validators.minLength("Username minLength is 2 chars.",2),t.validators.maxLength("Username maxLength is 15 chars.",15)]},{default:s(({props:o})=>[a(f,S({label:"Username",modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=_=>c.value=_)},o),null,16,["modelValue"])]),_:1},8,["value","rules"]),a(R,null,{default:s(({props:o})=>[a(g,{value:d.value,rules:[t.validators.required("Password is required."),t.validators.minLength("Password minLength is 6 chars.",6),t.validators.maxLength("Password maxLength is 15 chars.",15)]},{default:s(({props:_})=>[a(f,S({label:"Password",modelValue:d.value,"onUpdate:modelValue":e[2]||(e[2]=C=>d.value=C)},{...o,..._}),null,16,["modelValue"])]),_:2},1032,["value","rules"])]),_:1}),a(q,{color:"primary",inset:"",label:"Public IPv4",modelValue:p.value,"onUpdate:modelValue":e[3]||(e[3]=o=>p.value=o)},null,8,["modelValue"]),a(I,{modelValue:u(l),"onUpdate:modelValue":e[4]||(e[4]=o=>D(l)?l.value=o:null)},null,8,["modelValue"]),a(M,{filters:{cpu:(U=u(l))==null?void 0:U.cpu,memory:(w=u(l))==null?void 0:w.memory,ssd:(((h=u(l))==null?void 0:h.disk)??0)+10+u(N)(((k=u(l))==null?void 0:k.cpu)??0,((L=u(l))==null?void 0:L.memory)??0),publicIp:p.value},modelValue:u(v),"onUpdate:modelValue":e[5]||(e[5]=o=>D(v)?v.value=o:null)},null,8,["filters","modelValue"])]}),_:1},8,["modelValue"])]),_:1},512)}}}),te={name:"UmbrelView",components:{TfUmbrel:le,TfDeploymentList:Z},setup(){return{name:T.Umbrel}}},oe={class:"mt-4"};function se($,r,b,y,m,c){const d=n("TfUmbrel"),p=n("TfDeploymentList");return E(),Q(J,null,[a(d),B("div",oe,[a(p,{"project-name":y.name},null,8,["project-name"])])],64)}const ie=G(te,[["render",se]]);export{ie as default};
