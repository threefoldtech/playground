import{d as F,u as H,r as d,a as C,b as i,o as R,c as W,w as n,g as I,e as V,f as a,m as S,h as v,i as k,j as h,k as x,n as L,_ as z,l as G,F as K}from"./index-df6f743d.js";import{i as D,_ as A,P as B,j as Y,d as Q,k as J,l as X,a as Z}from"./tf_deployment_list.vue_vue_type_script_setup_true_lang-1803a4f6.js";import{_ as U}from"./select_gateway_node.vue_vue_type_script_setup_true_lang-ef88227d.js";import"./list_table.vue_vue_type_script_setup_true_lang-046c7938.js";const ee=h("a",{target:"_blank",href:"https://manual.grid.tf/weblets/weblets_peertube.html",class:"app-link"}," Quick start documentation ",-1),ae={name:"TfPeertube",components:{SelectSolutionFlavor:D,SelectGatewayNode:U,SelectFarm:A}},te=F({...ae,setup($){const t=H(),E=d(!1),c=C(),u=d("PT"+I(9)),f=d(""),m=d(I(12)),l=d(),_=d(),p=d();async function M(){t.value.setStatus("deploy");const o=B.Peertube.toLowerCase(),e=Y({deploymentName:u.value,projectName:o,twinId:c.profile.twinId}),y=e+"."+_.value.domain;let r,b;try{r=await x(c.profile,o),await t.value.validateBalance(r),b=await Q(r,{name:u.value,machines:[{name:u.value,cpu:l.value.cpu,memory:l.value.memory,disks:[{size:l.value.disk,mountPoint:"/data"}],flist:"https://hub.grid.tf/tf-official-apps/peertube-v3.1.1.flist",entryPoint:"/sbin/zinit init",farmId:p.value.farmID,farmName:p.value.name,country:p.value.country,planetary:!0,envs:[{key:"SSH_KEY",value:c.profile.ssh},{key:"PEERTUBE_ADMIN_EMAIL",value:f.value},{key:"PT_INITIAL_ROOT_PASSWORD",value:m.value},{key:"PEERTUBE_WEBSERVER_HOSTNAME",value:y}]}]})}catch(P){return t.value.setStatus("failed",L(P,"Failed to deploy a peertube instance."))}try{t.value.setStatus("deploy","Preparing to deploy gateway..."),await J(r,{name:e,nodeId:_.value.id,backends:[`http://[${b[0].planetary}]:9000`]}),t.value.reloadDeploymentsList(),t.value.setStatus("success","Successfully deployed a peertube instance."),t.value.openDialog(b,{SSH_KEY:"Public SSH Key",PEERTUBE_ADMIN_EMAIL:"Peertube Admin Email",PT_INITIAL_ROOT_PASSWORD:"Peertube Initial Root Password",PEERTUBE_WEBSERVER_HOSTNAME:"Peertube Webserver Hostname"})}catch(P){t.value.setStatus("deploy","Rollbacking back due to fail to deploy gateway..."),await X(r,u.value),t.value.setStatus("failed",L(P,"Failed to deploy a peertube instance."))}}return(o,e)=>{const y=i("v-text-field"),r=i("input-validator"),b=i("password-input-wrapper"),P=i("form-validator"),O=i("v-btn"),j=i("weblet-layout");return R(),W(j,{ref_key:"layout",ref:t},{title:n(()=>[V("Deploy a Peertube Instance")]),subtitle:n(()=>[V(" Peertube aspires to be a decentralized and free/libre alternative to video broadcasting services. "),ee]),"footer-actions":n(()=>[a(O,{color:"primary",variant:"tonal",onClick:M,disabled:!E.value},{default:n(()=>[V(" Deploy ")]),_:1},8,["disabled"])]),default:n(()=>[a(P,{modelValue:E.value,"onUpdate:modelValue":e[6]||(e[6]=g=>E.value=g)},{default:n(()=>{var g,T,N;return[a(r,{value:u.value,rules:[o.validators.required("Name is required."),o.validators.minLength("Name minLength is 2 chars.",2),o.validators.maxLength("Name maxLength is 15 chars.",15)]},{default:n(({props:s})=>[a(y,S({label:"Name",modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=w=>u.value=w)},s),null,16,["modelValue"])]),_:1},8,["value","rules"]),a(r,{value:f.value,rules:[o.validators.required("Email is required."),o.validators.isEmail("Please provide a valid email address.")]},{default:n(({props:s})=>[a(y,S({label:"Admin Email",modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=w=>f.value=w)},s),null,16,["modelValue"])]),_:1},8,["value","rules"]),a(b,null,{default:n(({props:s})=>[a(r,{value:m.value,rules:[o.validators.required("Password is required."),o.validators.minLength("Password minLength is 6 chars.",6),o.validators.maxLength("Password maxLength is 15 chars.",15)]},{default:n(({props:w})=>[a(y,S({label:"Password",modelValue:m.value,"onUpdate:modelValue":e[2]||(e[2]=q=>m.value=q)},{...s,...w}),null,16,["modelValue"])]),_:2},1032,["value","rules"])]),_:1}),a(D,{modelValue:v(l),"onUpdate:modelValue":e[3]||(e[3]=s=>k(l)?l.value=s:null)},null,8,["modelValue"]),a(U,{modelValue:v(_),"onUpdate:modelValue":e[4]||(e[4]=s=>k(_)?_.value=s:null)},null,8,["modelValue"]),a(A,{filters:{cpu:(g=v(l))==null?void 0:g.cpu,memory:(T=v(l))==null?void 0:T.memory,ssd:(N=v(l))==null?void 0:N.disk,publicIp:!1},modelValue:v(p),"onUpdate:modelValue":e[5]||(e[5]=s=>k(p)?p.value=s:null)},null,8,["filters","modelValue"])]}),_:1},8,["modelValue"])]),_:1},512)}}}),le={name:"PeertubeView",components:{TfPeertube:te,TfDeploymentList:Z},setup(){return{name:B.Peertube}}},oe={class:"mt-4"};function se($,t,E,c,u,f){const m=i("TfPeertube"),l=i("TfDeploymentList");return R(),G(K,null,[a(m),h("div",oe,[a(l,{"project-name":c.name},null,8,["project-name"])])],64)}const de=z(le,[["render",se]]);export{de as default};
