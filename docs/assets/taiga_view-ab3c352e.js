import{d as W,u as K,r as i,a as Y,b as m,o as O,c as Q,w as t,g as D,e as w,f as a,h as b,m as k,i as V,j as M,H as J,p as y,q as h,s as F,y as X,z as P,_ as Z,A as ee,F as ae}from"./index-0b744afb.js";import{_ as H,P as R,d as le,r as te}from"./root_fs-3cd83c23.js";import{g as x,h as se,i as oe,r as ne,_ as ue}from"./tf_deployment_list.vue_vue_type_script_setup_true_lang-9f7c35ec.js";import{_ as $}from"./select_gateway_node.vue_vue_type_script_setup_true_lang-2c1545e5.js";import{c as ie,_ as j}from"./smtp_server.vue_vue_type_script_setup_true_lang-eee58c4a.js";import"./list_table.vue_vue_type_script_setup_true_lang-54d7fb0b.js";const re=F("a",{target:"_blank",href:"https://library.threefold.me/info/manual/#/manual__weblets_taiga",class:"app-link"}," Quick start documentation ",-1),me={name:"TfTaiga",components:{SmtpServer:j,SelectSolutionFlavor:x,SelectGatewayNode:$,SelectFarm:H}},de=W({...me,setup(q){const s=K(),T=i(),S=Y(),r=i("TG"+D(9)),g=i("admin"),v=i(D(12)),_=i(""),o=i(),E=i(),c=i(),u=i(ie());async function B(){s.value.setStatus("deploy");const I=R.Taiga.toLowerCase(),e=se({deploymentName:r.value,projectName:I,twinId:S.profile.twinId}),f=e+"."+E.value.domain;let n,A;try{n=await X(S.profile,I),await s.value.validateBalance(n),A=await le(n,{name:r.value,machines:[{name:r.value,cpu:o.value.cpu,memory:o.value.memory,disks:[{size:o.value.disk,mountPoint:"/var/lib/docker"}],flist:"https://hub.grid.tf/tf-official-apps/grid3_taiga_docker-latest.flist",entryPoint:"/sbin/zinit init",rootFilesystemSize:te(o.value.cpu,o.value.memory),farmId:c.value.farmID,farmName:c.value.name,country:c.value.country,planetary:!0,envs:[{key:"SSH_KEY",value:S.profile.ssh},{key:"DOMAIN_NAME",value:f},{key:"ADMIN_USERNAME",value:g.value},{key:"ADMIN_PASSWORD",value:v.value},{key:"ADMIN_EMAIL",value:_.value},...u.value.enabled?[{key:"EMAIL_HOST",value:u.value.hostname},{key:"EMAIL_PORT",value:u.value.port.toString()},{key:"EMAIL_HOST_USER",value:u.value.username},{key:"EMAIL_HOST_PASSWORD",value:u.value.password},{key:"EMAIL_USE_TLS",value:u.value.tls?"True":"False"},{key:"EMAIL_USE_SSL",value:u.value.ssl?"True":"False"}]:[]]}]})}catch(L){return s.value.setStatus("failed",P(L,"Failed to deploy a taiga instance."))}try{s.value.setStatus("deploy","Preparing to deploy gateway..."),await oe(n,{name:e,nodeId:E.value.id,backends:[`http://[${A[0].planetary}]:9000/`]}),s.value.reloadDeploymentsList(),s.value.setStatus("success","Successfully deployed a taiga instance."),s.value.openDialog(A,{SSH_KEY:"Public SSH Key",DOMAIN_NAME:"Domain Name",ADMIN_USERNAME:"Admin Username",ADMIN_PASSWORD:"Admin Password",ADMIN_EMAIL:"Admin Email",DEFAULT_FROM_EMAIL:"Default Form Email",EMAIL_USE_TLS:"Email Use TLS",EMAIL_USE_SSL:"Email Use SSL",EMAIL_HOST:"Email Host",EMAIL_PORT:"Email Port",EMAIL_HOST_USER:"Email Host User",EMAIL_HOST_PASSWORD:"Email Host Password"})}catch(L){s.value.setStatus("deploy","Rollbacking back due to fail to deploy gateway..."),await ne(n,r.value),s.value.setStatus("failed",P(L,"Failed to deploy a taiga instance."))}}return(I,e)=>{const f=m("v-text-field"),n=m("input-validator"),A=m("password-input-wrapper"),L=m("d-tabs"),C=m("v-btn"),z=m("weblet-layout");return O(),Q(z,{ref_key:"layout",ref:s},{title:t(()=>[w("Deploy a Taiga Instance")]),subtitle:t(()=>[w(" Taiga is the project management tool for multi-functional agile teams. It has a rich feature set and at the same time it is very simple to start with through its intuitive user interface. "),re]),"footer-actions":t(()=>{var d;return[a(C,{color:"primary",variant:"tonal",onClick:B,disabled:(d=T.value)==null?void 0:d.invalid},{default:t(()=>[w(" Deploy ")]),_:1},8,["disabled"])]}),default:t(()=>[a(L,{tabs:[{title:"Base",value:"base"},{title:"Mail Server",value:"smtp"}],ref_key:"tabs",ref:T},{base:t(()=>{var d,N,U;return[a(n,{value:r.value,rules:[b("Name is required."),k("Name minLength is 2 chars.",2),V("Name maxLength is 15 chars.",15)]},{default:t(({props:l})=>[a(f,M({label:"Name",modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=p=>r.value=p)},l),null,16,["modelValue"])]),_:1},8,["value","rules"]),a(n,{value:g.value,rules:[b("Username is required."),k("Username minLength is 2 chars.",2),V("Username maxLength is 15 chars.",15)]},{default:t(({props:l})=>[a(f,M({label:"Username",modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=p=>g.value=p)},l),null,16,["modelValue"])]),_:1},8,["value","rules"]),a(A,null,{default:t(({props:l})=>[a(n,{value:v.value,rules:[b("Password is required."),k("Password minLength is 6 chars.",6),V("Password maxLength is 15 chars.",15)]},{default:t(({props:p})=>[a(f,M({label:"Password",modelValue:v.value,"onUpdate:modelValue":e[2]||(e[2]=G=>v.value=G)},{...l,...p}),null,16,["modelValue"])]),_:2},1032,["value","rules"])]),_:1}),a(n,{value:_.value,rules:[b("Email is required."),J("Please provide a valid email address.")]},{default:t(({props:l})=>[a(f,M({label:"Email"},l,{modelValue:_.value,"onUpdate:modelValue":e[3]||(e[3]=p=>_.value=p)}),null,16,["modelValue"])]),_:1},8,["value","rules"]),a(x,{modelValue:y(o),"onUpdate:modelValue":e[4]||(e[4]=l=>h(o)?o.value=l:null)},null,8,["modelValue"]),a($,{modelValue:y(E),"onUpdate:modelValue":e[5]||(e[5]=l=>h(E)?E.value=l:null)},null,8,["modelValue"]),a(H,{filters:{cpu:(d=y(o))==null?void 0:d.cpu,memory:(N=y(o))==null?void 0:N.memory,ssd:(U=y(o))==null?void 0:U.disk,publicIp:!1},modelValue:y(c),"onUpdate:modelValue":e[6]||(e[6]=l=>h(c)?c.value=l:null)},null,8,["filters","modelValue"])]}),smtp:t(()=>[a(j,{modelValue:u.value,"onUpdate:modelValue":e[7]||(e[7]=d=>u.value=d),email:"",tls:"",ssl:""},{default:t(()=>[w(" Configure these settings only If you have an smtp service and you know what youâ€™re doing. ")]),_:1},8,["modelValue"])]),_:1},512)]),_:1},512)}}}),pe={name:"TaigaView",components:{TfTaiga:de,TfDeploymentList:ue},setup(){return{name:R.Taiga}}},ve={class:"mt-4"};function _e(q,s,T,S,r,g){const v=m("TfTaiga"),_=m("TfDeploymentList");return O(),ee(ae,null,[a(v),F("div",ve,[a(_,{"project-name":S.name},null,8,["project-name"])])],64)}const Ae=Z(pe,[["render",_e]]);export{Ae as default};
