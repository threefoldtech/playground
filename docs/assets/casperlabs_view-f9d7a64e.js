import{i as N,_ as h,P as L,j as F,d as I,k as j,l as A,a as H}from"./tf_deployment_list.vue_vue_type_script_setup_true_lang-1803a4f6.js";import{d as M,u as U,r as v,a as R,b as m,o as $,c as G,w as i,g as K,e as S,f as l,m as q,h as p,i as w,j as D,k as z,n as C,_ as O,l as Y,F as Q}from"./index-df6f743d.js";import{_ as P}from"./select_gateway_node.vue_vue_type_script_setup_true_lang-ef88227d.js";import"./list_table.vue_vue_type_script_setup_true_lang-046c7938.js";const W=D("a",{target:"_blank",href:"https://manual.grid.tf/weblets/weblets_casper.html",class:"app-link"}," Quick start documentation ",-1),J={name:"TFCasperlabs",components:{SelectSolutionFlavor:N,SelectGatewayNode:P,SelectFarm:h}},X=M({...J,setup(E){const a=U(),_=v(!1),y=R(),o=v("CL"+K(9)),t=v(),n=v(),s=v();async function T(){a.value.setStatus("deploy");const d=L.Caprover.toLowerCase(),e=F({deploymentName:o.value,projectName:d,twinId:y.profile.twinId}),b=e+"."+n.value.domain;let r,c;try{r=await z(y.profile,d),await a.value.validateBalance(r),c=await I(r,{name:o.value,machines:[{name:o.value,cpu:t.value.cpu,memory:t.value.memory,disks:[{size:t.value.disk,mountPoint:"/data"}],flist:"https://hub.grid.tf/tf-official-apps/casperlabs-latest.flist",entryPoint:"/init.sh",farmId:s.value.farmID,farmName:s.value.name,country:s.value.country,envs:[{key:"SSH_KEY",value:b},{key:"CASPERLABS_HOSTNAME",value:b}]}]})}catch(f){return a.value.setStatus("failed",C(f,"Failed to deploy a Casperlabs instance."))}try{a.value.setStatus("deploy","Preparing to deploy gateway..."),await j(r,{name:e,nodeId:n.value.id,backends:[`http://[${c[0].planetary}]:80`]}),a.value.reloadDeploymentsList(),a.value.setStatus("success","Successfully deployed a Casperlabs instance."),a.value.openDialog(c,{SSH_KEY:"SSH Key",CASPERLABS_HOSTNAME:"Casperlabs Hostname"})}catch(f){a.value.setStatus("deploy","Rollbacking back due to fail to deploy gateway..."),await A(r,o.value),a.value.setStatus("failed",C(f,"Failed to deploy a Casperlabs instance."))}}return(d,e)=>{const b=m("v-text-field"),r=m("input-validator"),c=m("form-validator"),f=m("v-btn"),x=m("weblet-layout");return $(),G(x,{ref_key:"layout",ref:a},{title:i(()=>[S("Deploy a Casperlabs Instance ")]),subtitle:i(()=>[S(" Casper Network is a blockchain protocol built from the ground up to remain true to core Web3 principles and adapt to the needs of our evolving world. "),W]),"footer-actions":i(()=>[l(f,{color:"primary",variant:"tonal",onClick:T,disabled:!_.value},{default:i(()=>[S(" Deploy ")]),_:1},8,["disabled"])]),default:i(()=>[l(c,{modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=g=>_.value=g)},{default:i(()=>{var g,k,V;return[l(r,{value:o.value,rules:[d.validators.required("Name is required."),d.validators.minLength("Name minLength is 2 chars.",2),d.validators.maxLength("Name maxLength is 15 chars.",15)]},{default:i(({props:u})=>[l(b,q({label:"Name",modelValue:o.value,"onUpdate:modelValue":e[0]||(e[0]=B=>o.value=B)},u),null,16,["modelValue"])]),_:1},8,["value","rules"]),l(N,{modelValue:p(t),"onUpdate:modelValue":e[1]||(e[1]=u=>w(t)?t.value=u:null)},null,8,["modelValue"]),l(P,{modelValue:p(n),"onUpdate:modelValue":e[2]||(e[2]=u=>w(n)?n.value=u:null)},null,8,["modelValue"]),l(h,{filters:{cpu:(g=p(t))==null?void 0:g.cpu,memory:(k=p(t))==null?void 0:k.memory,ssd:(V=p(t))==null?void 0:V.disk,publicIp:!1},modelValue:p(s),"onUpdate:modelValue":e[3]||(e[3]=u=>w(s)?s.value=u:null)},null,8,["filters","modelValue"])]}),_:1},8,["modelValue"])]),_:1},512)}}}),Z={name:"CasperlabsView",components:{TfDeploymentList:H,TfCasperlabs:X},setup(){return{name:L.Casperlabs}}},ee={class:"mt-4"};function ae(E,a,_,y,o,t){const n=m("tf-casperlabs"),s=m("TfDeploymentList");return $(),Y(Q,null,[l(n),D("div",ee,[l(s,{"project-name":y.name},null,8,["project-name"])])],64)}const ne=O(Z,[["render",ae]]);export{ne as default};
