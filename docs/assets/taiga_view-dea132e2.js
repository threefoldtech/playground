import{d as z,u as G,r,a as W,b as d,o as U,c as x,w as s,g as V,e as b,f as a,m as M,h as S,i as k,j as D,k as K,n as N,_ as Y,l as Q,F as J}from"./index-df6f743d.js";import{i as P,_ as O,P as F,j as X,d as Z,r as ee,k as ae,l as le,a as te}from"./tf_deployment_list.vue_vue_type_script_setup_true_lang-1803a4f6.js";import{_ as R}from"./select_gateway_node.vue_vue_type_script_setup_true_lang-ef88227d.js";import{c as se,_ as H}from"./smtp_server.vue_vue_type_script_setup_true_lang-26828204.js";import"./list_table.vue_vue_type_script_setup_true_lang-046c7938.js";const oe=D("a",{target:"_blank",href:"https://manual.grid.tf/weblets/weblets_taiga.html",class:"app-link"}," Quick start documentation ",-1),ne={name:"TfTaiga",components:{SmtpServer:H,SelectSolutionFlavor:P,SelectGatewayNode:R,SelectFarm:O}},ie=z({...ne,setup($){const o=G(),T=r(),g=W(),m=r("TG"+V(9)),E=r("admin"),_=r(V(12)),c=r(""),n=r(),L=r(),f=r(),u=r(se());async function q(){o.value.setStatus("deploy");const l=F.Taiga.toLowerCase(),e=X({deploymentName:m.value,projectName:l,twinId:g.profile.twinId}),y=e+"."+L.value.domain;let i,w;try{i=await K(g.profile,l),await o.value.validateBalance(i),w=await Z(i,{name:m.value,machines:[{name:m.value,cpu:n.value.cpu,memory:n.value.memory,disks:[{size:n.value.disk,mountPoint:"/var/lib/docker"}],flist:"https://hub.grid.tf/tf-official-apps/grid3_taiga_docker-latest.flist",entryPoint:"/sbin/zinit init",rootFilesystemSize:ee(n.value.cpu,n.value.memory),farmId:f.value.farmID,farmName:f.value.name,country:f.value.country,planetary:!0,envs:[{key:"SSH_KEY",value:g.profile.ssh},{key:"DOMAIN_NAME",value:y},{key:"ADMIN_USERNAME",value:E.value},{key:"ADMIN_PASSWORD",value:_.value},{key:"ADMIN_EMAIL",value:c.value},...u.value.enabled?[{key:"EMAIL_HOST",value:u.value.hostname},{key:"EMAIL_PORT",value:u.value.port.toString()},{key:"EMAIL_HOST_USER",value:u.value.username},{key:"EMAIL_HOST_PASSWORD",value:u.value.password},{key:"EMAIL_USE_TLS",value:u.value.tls?"True":"False"},{key:"EMAIL_USE_SSL",value:u.value.ssl?"True":"False"}]:[]]}]})}catch(A){return o.value.setStatus("failed",N(A,"Failed to deploy a taiga instance."))}try{o.value.setStatus("deploy","Preparing to deploy gateway..."),await ae(i,{name:e,nodeId:L.value.id,backends:[`http://[${w[0].planetary}]:9000/`]}),o.value.reloadDeploymentsList(),o.value.setStatus("success","Successfully deployed a taiga instance."),o.value.openDialog(w,{SSH_KEY:"Public SSH Key",DOMAIN_NAME:"Domain Name",ADMIN_USERNAME:"Admin Username",ADMIN_PASSWORD:"Admin Password",ADMIN_EMAIL:"Admin Email",DEFAULT_FROM_EMAIL:"Default Form Email",EMAIL_USE_TLS:"Email Use TLS",EMAIL_USE_SSL:"Email Use SSL",EMAIL_HOST:"Email Host",EMAIL_PORT:"Email Port",EMAIL_HOST_USER:"Email Host User",EMAIL_HOST_PASSWORD:"Email Host Password"})}catch(A){o.value.setStatus("deploy","Rollbacking back due to fail to deploy gateway..."),await le(i,m.value),o.value.setStatus("failed",N(A,"Failed to deploy a taiga instance."))}}return(l,e)=>{const y=d("v-text-field"),i=d("input-validator"),w=d("password-input-wrapper"),A=d("d-tabs"),j=d("v-btn"),B=d("weblet-layout");return U(),x(B,{ref_key:"layout",ref:o},{title:s(()=>[b("Deploy a Taiga Instance")]),subtitle:s(()=>[b(" Taiga is the project management tool for multi-functional agile teams. It has a rich feature set and at the same time it is very simple to start with through its intuitive user interface. "),oe]),"footer-actions":s(()=>{var v;return[a(j,{color:"primary",variant:"tonal",onClick:q,disabled:(v=T.value)==null?void 0:v.invalid},{default:s(()=>[b(" Deploy ")]),_:1},8,["disabled"])]}),default:s(()=>[a(A,{tabs:[{title:"Base",value:"base"},{title:"Mail Server",value:"smtp"}],ref_key:"tabs",ref:T},{base:s(()=>{var v,I,h;return[a(i,{value:m.value,rules:[l.validators.required("Name is required."),l.validators.minLength("Name minLength is 2 chars.",2),l.validators.maxLength("Name maxLength is 15 chars.",15)]},{default:s(({props:t})=>[a(y,M({label:"Name",modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=p=>m.value=p)},t),null,16,["modelValue"])]),_:1},8,["value","rules"]),a(i,{value:E.value,rules:[l.validators.required("Username is required."),l.validators.minLength("Username minLength is 2 chars.",2),l.validators.maxLength("Username maxLength is 15 chars.",15)]},{default:s(({props:t})=>[a(y,M({label:"Username",modelValue:E.value,"onUpdate:modelValue":e[1]||(e[1]=p=>E.value=p)},t),null,16,["modelValue"])]),_:1},8,["value","rules"]),a(w,null,{default:s(({props:t})=>[a(i,{value:_.value,rules:[l.validators.required("Password is required."),l.validators.minLength("Password minLength is 6 chars.",6),l.validators.maxLength("Password maxLength is 15 chars.",15)]},{default:s(({props:p})=>[a(y,M({label:"Password",modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=C=>_.value=C)},{...t,...p}),null,16,["modelValue"])]),_:2},1032,["value","rules"])]),_:1}),a(i,{value:c.value,rules:[l.validators.required("Email is required."),l.validators.isEmail("Please provide a valid email address.")]},{default:s(({props:t})=>[a(y,M({label:"Email"},t,{modelValue:c.value,"onUpdate:modelValue":e[3]||(e[3]=p=>c.value=p)}),null,16,["modelValue"])]),_:1},8,["value","rules"]),a(P,{modelValue:S(n),"onUpdate:modelValue":e[4]||(e[4]=t=>k(n)?n.value=t:null)},null,8,["modelValue"]),a(R,{modelValue:S(L),"onUpdate:modelValue":e[5]||(e[5]=t=>k(L)?L.value=t:null)},null,8,["modelValue"]),a(O,{filters:{cpu:(v=S(n))==null?void 0:v.cpu,memory:(I=S(n))==null?void 0:I.memory,ssd:(h=S(n))==null?void 0:h.disk,publicIp:!1},modelValue:S(f),"onUpdate:modelValue":e[6]||(e[6]=t=>k(f)?f.value=t:null)},null,8,["filters","modelValue"])]}),smtp:s(()=>[a(H,{modelValue:u.value,"onUpdate:modelValue":e[7]||(e[7]=v=>u.value=v),email:"",tls:"",ssl:""},{default:s(()=>[b(" Configure these settings only If you have an smtp service and you know what youâ€™re doing. ")]),_:1},8,["modelValue"])]),_:1},512)]),_:1},512)}}}),ue={name:"TaigaView",components:{TfTaiga:ie,TfDeploymentList:te},setup(){return{name:F.Taiga}}},re={class:"mt-4"};function me($,o,T,g,m,E){const _=d("TfTaiga"),c=d("TfDeploymentList");return U(),Q(J,null,[a(_),D("div",re,[a(c,{"project-name":g.name},null,8,["project-name"])])],64)}const fe=Y(ue,[["render",me]]);export{fe as default};
