import{d as R,r as d,a as U,b as s,o as y,l as x,f as o,w as t,F as D,k,e as n,t as h,s as z,j as G,n as L,D as g,c as S,_ as j}from"./index-df6f743d.js";import{_ as $,g as H}from"./list_table.vue_vue_type_script_setup_true_lang-046c7938.js";const Q=G("a",{class:"app-link",href:"https://manual.grid.tf/tfchain/tfchain_external_service_contract.html",target:"_blank"},"Quick start documentation",-1),q={name:"TfContractsList",components:{ListTable:$}},J=R({...q,setup(T){const v=d(),p=U(),i=d([]),r=d(!1),c=d([]),C=[{title:"#",key:"index"},{title:"PLACEHOLDER",key:"data-table-select"},{title:"ID",key:"contractId"},{title:"Type",key:"type"},{title:"State",key:"state"},{title:"Billing Rate",key:"consumption"},{title:"Solution Type",key:"solutionType"},{title:"Solution Name",key:"solutionName"},{title:"Created At",key:"createdAt"},{title:"Expiration",key:"expiration"},{title:"Actions",key:"actions",sortable:!1}];async function b(){r.value=!0,i.value=[];const l=await k(p.profile);i.value=await H(l),r.value=!1}const m=d();async function V(l){r.value=!0,m.value=l;try{const u=await(await k(p.profile)).zos.getDeployment({contractId:l});v.value.openDialog(u,!1,!0)}catch(a){v.value.setStatus("failed",L(a,`Failed to load details of contract(${l})`))}m.value=void 0,r.value=!1}function I(l){switch(l){case g.Created:return"success";case g.Deleted:return"error";case g.GracePeriod:return"warning";case g.OutOfFunds:return"info"}}const _=d(!1),f=d(!1);async function N(){_.value=!1,f.value=!0;try{const l=await k(p.profile);c.value.length===i.value.length?await l.contracts.cancelMyContracts():await l.contracts.batchCancelContracts({ids:c.value.map(a=>a.contractId)}),i.value=i.value.filter(a=>!c.value.includes(a)),c.value=[]}catch(l){v.value.setStatus("failed",L(l,"Failed to delete some of the selected contracts."))}f.value=!1}return(l,a)=>{const u=s("v-btn"),w=s("v-chip"),A=s("weblet-layout"),B=s("v-card-title"),E=s("v-card-text"),F=s("v-spacer"),M=s("v-card-actions"),O=s("v-card"),P=s("v-dialog");return y(),x(D,null,[o(A,{ref_key:"layout",ref:v,onMount:b},{title:t(()=>[n("Contracts List")]),subtitle:t(()=>[Q]),"header-actions":t(({hasProfile:e})=>[o(u,{"prepend-icon":"mdi-refresh",color:"primary",variant:"tonal",disabled:r.value||f.value||!e,onClick:b},{default:t(()=>[n(" refresh ")]),_:2},1032,["disabled"])]),"footer-actions":t(()=>[o(u,{variant:"outlined",color:"error",disabled:!c.value.length||r.value||f.value,"prepend-icon":"mdi-trash-can-outline",onClick:a[1]||(a[1]=e=>_.value=!0)},{default:t(()=>[n(" Delete ")]),_:1},8,["disabled"])]),default:t(()=>[o($,{headers:C,items:i.value,loading:r.value,deleting:f.value,modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=e=>c.value=e),"no-data-text":"No contracts found on this account."},{["item.index"]:t(({item:e})=>[n(h(i.value.indexOf(e.value)+1),1)]),["item.state"]:t(({item:e})=>[o(w,{color:I(e.value.state)},{default:t(()=>[n(h(e.value.state),1)]),_:2},1032,["color"])]),["item.actions"]:t(({item:e})=>[o(u,{color:"secondary",variant:"tonal",onClick:X=>e.value.type!=="name"?V(e.value.contractId):v.value.openDialog(e.value,!1,!0),disabled:r.value&&m.value!==e.value.contractId||f.value,loading:m.value==e.value.contractId},{default:t(()=>[n(" Show Details ")]),_:2},1032,["onClick","disabled","loading"])]),_:2},1032,["items","loading","deleting","modelValue"])]),_:1},512),o(P,{width:"70%",modelValue:_.value,"onUpdate:modelValue":a[3]||(a[3]=e=>_.value=e)},{default:t(()=>[o(O,null,{default:t(()=>[o(B,{class:"text-h5"},{default:t(()=>[n(" Are you sure you want to delete the following contracts? ")]),_:1}),o(E,null,{default:t(()=>[(y(!0),x(D,null,z(c.value,e=>(y(),S(w,{class:"ma-1",color:"primary",label:"",key:e.contractId},{default:t(()=>[n(h(e.contractId),1)]),_:2},1024))),128))]),_:1}),o(M,null,{default:t(()=>[o(F),o(u,{color:"error",variant:"text",onClick:N},{default:t(()=>[n(" Remove ")]),_:1}),o(u,{color:"error",variant:"tonal",onClick:a[2]||(a[2]=e=>_.value=!1)},{default:t(()=>[n(" Cancel ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),K={name:"ContractsList",components:{TfContractsList:J}};function W(T,v,p,i,r,c){const C=s("TfContractsList");return y(),S(C)}const ee=j(K,[["render",W]]);export{ee as default};
