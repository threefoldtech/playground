import{d as q,u as H,r as u,a as J,b as r,o as L,c as B,w as o,g as D,e as V,f as a,h as S,m as E,i as N,j as g,H as C,p as b,q as P,s as R,y as W,z as F,_ as z,A as K,F as Q}from"./index-0b744afb.js";import{_ as A,P as x,d as X}from"./root_fs-3cd83c23.js";import{g as T,h as Y,i as Z,r as ee,_ as ae}from"./tf_deployment_list.vue_vue_type_script_setup_true_lang-9f7c35ec.js";import{_ as O}from"./select_gateway_node.vue_vue_type_script_setup_true_lang-2c1545e5.js";import"./list_table.vue_vue_type_script_setup_true_lang-54d7fb0b.js";const le=R("a",{target:"_blank",href:"https://library.threefold.me/info/manual/#/manual__weblets_funkwhale",class:"app-link"}," Quick start documentation ",-1),te={name:"TfFunkwhale",components:{SelectSolutionFlavor:T,SelectGatewayNode:O,SelectFarm:A}},oe=q({...te,setup($){const t=H(),h=u(!1),k=J(),s=u("FW"+D(9)),f=u("admin"),m=u(""),d=u(D(12)),p=u(),_=u(),c=u();async function j(){t.value.setStatus("deploy");const U=x.Funkwhale.toLowerCase(),e=Y({deploymentName:s.value,projectName:U,twinId:k.profile.twinId}),v=e+"."+_.value.domain;let n,y;try{n=await W(k.profile,U),await t.value.validateBalance(n),y=await X(n,{name:s.value,machines:[{name:s.value,cpu:p.value.cpu,memory:p.value.memory,disks:[{size:p.value.disk,mountPoint:"/data"}],flist:"https://hub.grid.tf/tf-official-apps/funkwhale-dec21.flist",entryPoint:"/init.sh",farmId:c.value.farmID,farmName:c.value.name,country:c.value.country,envs:[{key:"FUNKWHALE_HOSTNAME",value:v},{key:"DJANGO_SUPERUSER_EMAIL",value:m.value},{key:"DJANGO_SUPERUSER_USERNAME",value:f.value},{key:"DJANGO_SUPERUSER_PASSWORD",value:d.value}]}]})}catch(w){return t.value.setStatus("failed",F(w,"Failed to deploy a funkwhale instance."))}try{t.value.setStatus("deploy","Preparing to deploy gateway..."),await Z(n,{name:e,nodeId:_.value.id,backends:[`http://[${y[0].planetary}]:80/`]}),t.value.reloadDeploymentsList(),t.value.setStatus("success","Successfully deployed a funkwhale instance."),t.value.openDialog(y,{FUNKWHALE_HOSTNAME:"Funkwhale Hostname",DJANGO_SUPERUSER_EMAIL:"Django Superuser Email",DJANGO_SUPERUSER_USERNAME:"Diango Superuser Username",DJANGO_SUPERUSER_PASSWORD:"Django Superuser Password"})}catch(w){t.value.setStatus("deploy","Rollbacking back due to fail to deploy gateway..."),await ee(n,s.value),t.value.setStatus("failed",F(w,"Failed to deploy a funkwhale instance."))}}return(U,e)=>{const v=r("v-text-field"),n=r("input-validator"),y=r("password-input-wrapper"),w=r("form-validator"),G=r("v-btn"),M=r("weblet-layout");return L(),B(M,{ref_key:"layout",ref:t},{title:o(()=>[V("Deploy a Funkwhale Instance ")]),subtitle:o(()=>[V(" Funkwhale is social platform to enjoy and share music. Funkwhale is a community-driven project that lets you listen and share music and audio within a decentralized, open network. "),le]),"footer-actions":o(()=>[a(G,{color:"primary",variant:"tonal",onClick:j,disabled:!h.value},{default:o(()=>[V(" Deploy ")]),_:1},8,["disabled"])]),default:o(()=>[a(w,{modelValue:h.value,"onUpdate:modelValue":e[7]||(e[7]=l=>h.value=l)},{default:o(()=>[a(n,{value:s.value,rules:[S("Name is required."),E("Name minLength is 2 chars.",2),N("Name maxLength is 15 chars.",15)]},{default:o(({props:l})=>[a(v,g({label:"Name",modelValue:s.value,"onUpdate:modelValue":e[0]||(e[0]=i=>s.value=i)},l),null,16,["modelValue"])]),_:1},8,["value","rules"]),a(n,{value:f.value,rules:[S("Username is required."),E("Username minLength is 2 chars.",2),N("Username maxLength is 15 chars.",15)]},{default:o(({props:l})=>[a(v,g({label:"Username",modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=i=>f.value=i)},l),null,16,["modelValue"])]),_:1},8,["value","rules"]),a(n,{value:m.value,rules:[S("Email is required."),C("Please provide a valid email address.")]},{default:o(({props:l})=>[a(v,g({label:"Email",placeholder:"This email will be used to login to your instance.",modelValue:m.value,"onUpdate:modelValue":e[2]||(e[2]=i=>m.value=i)},l),null,16,["modelValue"])]),_:1},8,["value","rules"]),a(y,null,{default:o(({props:l})=>[a(n,{value:d.value,rules:[S("Password is required."),E("Password minLength is 6 chars.",6),N("Password maxLength is 15 chars.",15)]},{default:o(({props:i})=>[a(v,g({label:"Password",modelValue:d.value,"onUpdate:modelValue":e[3]||(e[3]=I=>d.value=I)},{...l,...i}),null,16,["modelValue"])]),_:2},1032,["value","rules"])]),_:1}),a(T,{modelValue:b(p),"onUpdate:modelValue":e[4]||(e[4]=l=>P(p)?p.value=l:null)},null,8,["modelValue"]),a(O,{modelValue:b(_),"onUpdate:modelValue":e[5]||(e[5]=l=>P(_)?_.value=l:null)},null,8,["modelValue"]),a(A,{modelValue:b(c),"onUpdate:modelValue":e[6]||(e[6]=l=>P(c)?c.value=l:null)},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1},512)}}}),ne={name:"FunkwhaleView",components:{TfFunkwhale:oe,TfDeploymentList:ae},setup(){return{name:x.Funkwhale}}},se={class:"mt-4"};function ue($,t,h,k,s,f){const m=r("TfFunkwhale"),d=r("TfDeploymentList");return L(),K(Q,null,[a(m),R("div",se,[a(d,{"project-name":k.name},null,8,["project-name"])])],64)}const ce=z(ne,[["render",ue]]);export{ce as default};
